@model IEnumerable<Heat_Lead.Models.ViewModels.CampaignViewModel>
@Html.AntiForgeryToken()

@{
    ViewBag.Title = "Twoje kampanie";
    Layout = "~/Views/Shared/_PanelLayout.cshtml";
}

<div class="Vert">

    <div class="Page-Title-Box">
        <div class="Campaign-Container-Title">
            Kampanie <div id="campaignCount">0/20</div>
            <a href="@Url.Action("Index", "Promote")" class="Button-Medium-Flex">Dodaj kampanie</a>

        </div>

        <div class="campaign-search-box">
            <input type="text" id="campaignSearch" placeholder="Wyszukaj kampanie">

        </div>

    </div>

</div>
<div class="Vert-campaign">

        <div id="campaign-container">
            @foreach (var campaign in Model)
            {

                <div class="campaign-wrapper" data-campaign-id="@campaign.CampaignId" ondragover="allowDrop(event)" ondrop="drop(event)">

                    <div class="campaign-box" draggable="true" ondragstart="drag(event)" ondragend="endDrag(event)" onclick="toggleTable(this)">

                        <div class="campaign-box-head">
                        <div class="campaign-box-head-name">
                            <span class="campaign-name-text">@campaign.CampaignName</span>

                        </div>

                            <div class="campaign-summary">

                                <div class="campaign-summary-line">
                                    <div class="campaign-summary-line-icon">
                                        <img src="~/images/Product-b.svg" alt="Panel Icon" width="18" height="18" />
                                    </div>Liczba produktów: @campaign.ProductsCount
                                </div>
                                <div class="campaign-summary-line">
                                    <div class="campaign-summary-line-icon">
                                        <img src="~/images/Time-b.svg" alt="Panel Icon" width="18" height="18" />
                                    </div>Data utworzenia:<div class="creationDate-data"></div>
                                </div>
                            </div>
                        <div class="Button-Page-Small-border">
                                <span class="toggle-text">Rozwiń</span>
                                <div class="arrow"></div>
                            </div>
                        </div>

                        <div class="campaign-box-data">
                            <div class="affiliate-box-data-info">
                                <div class="campaign-summary">
                                    Cały okres
                                    <div class="Hori-Line-w"></div>
                                    <div class="campaign-summary-line">
                                        <div class="campaign-summary-line-icon">
                                            <img src="~/images/Click-b.svg" alt="Panel Icon" width="18" height="18" />
                                        </div>Ruch na stronę:<div class="full-click-data">0</div>
                                    </div>

                                    <div class="campaign-summary-line">
                                        <div class="campaign-summary-line-icon">
                                            <img src="~/images/Basket-b.svg" alt="Panel Icon" width="18" height="18" />
                                        </div>Sprzedane produkty:<div class="full-orders-data">0</div>
                                    </div>
                                    <div class="campaign-summary-line">
                                        <div class="campaign-summary-line-icon">
                                            <img src="~/images/OrderValue-b.svg" alt="Panel Icon" width="18" height="18" />
                                        </div>Zarobki:<div class="full-earnings-data">0.00 zł</div>
                                    </div>
                                    <div class="campaign-summary-line">
                                        <div class="campaign-summary-line-icon">
                                            <img src="~/images/Chart-b.svg" alt="Panel Icon" width="18" height="18" />
                                        </div>Konwersja:<div class="fullOrdersToClicksRatio">0.00 %</div>
                                    </div>

                                </div>
                            </div>

                            <div class="affiliate-box-data-info">
                                <div class="campaign-summary">
                                    Ostatnie 30 dni
                                    <div class="Hori-Line-w"></div>
                                    <div class="campaign-summary-line">
                                        <div class="campaign-summary-line-icon">
                                            <img src="~/images/Click-b.svg" alt="Panel Icon" width="18" height="18" />
                                        </div>Ruch na stronę:<div class="click-data">0</div>
                                    </div>

                                    <div class="campaign-summary-line">
                                        <div class="campaign-summary-line-icon">
                                            <img src="~/images/Basket-b.svg" alt="Panel Icon" width="18" height="18" />
                                        </div>Sprzedane produkty:<div class="orders-data">0</div>
                                    </div>
                                    <div class="campaign-summary-line">
                                        <div class="campaign-summary-line-icon">
                                            <img src="~/images/OrderValue-b.svg" alt="Panel Icon" width="18" height="18" />
                                        </div>Zarobki:<div class="earnings-data">0.00 zł</div>
                                    </div>
                                    <div class="campaign-summary-line">
                                        <div class="campaign-summary-line-icon">
                                            <img src="~/images/Chart-b.svg" alt="Panel Icon" width="18" height="18" />
                                        </div>Konwersja:<div class="ordersToClicksRatio">0.00 %</div>
                                    </div>

                                </div>
                            </div>
                            <div class="chart-container-cam">
                                <canvas id="chart-@campaign.CampaignId"></canvas>
                            </div>

                        </div>

                    </div>
                    <div class="table-container">
                        <div class="camapign-manage-buttons">
                        <div class="Button-Page-Small-icon" onclick="deleteCampaign(@campaign.CampaignId)"><img src="~/images/Bin.svg" alt="Panel Icon" width="14" height="14" /> Usuń kampanię</div>
                        <button class="Button-Page-Small-icon" onclick="editCampaignName(this, '@campaign.CampaignId')"><img src="~/images/Settings.svg" alt="Panel Icon" width="14" height="14" />Zmień nazwę</button>
                        </div>

                        <table class="table-bordered">

                            <tbody>
                                @foreach (var affiliateLink in campaign.AffiliateLink)
                                {

                                    <tr>

                                        <td>
                                            <div class="svg-container">
                                                <div class="sub-line"></div>
                                                <img src="@affiliateLink.ProductImage" alt="@affiliateLink.ProductName" width="80" height="80"/>
                                            </div>
                                        </td>
                                        <td>
                                            <p class="p-product">@affiliateLink.ProductName</p>
                                            <p class="p-category">
                                                @if (affiliateLink.IsActive)
                                                {
                                                    <span class="status-active">Aktywny</span>
                                                }
                                                else
                                                {
                                                    <span class="status-inactive">Nieaktywny</span>
                                                }
                                            </p>
                                        </td>

                                        <td>
                                            <p class="p-product">
                                                <span class="rounded-input">@affiliateLink.AffiliateURL</span>
                                                <button class="Button-Copy" onclick="copyToClipboard('@affiliateLink.AffiliateURL')">Kopiuj</button>
                                            </p>
                                            <p class="p-category">Link Affiliacyjny</p>
                                        </td>
                                        <td>
                                            <p class="p-product">
                                                <form action="@Url.Action("Index", "CanvasJS")" method="post">
                                                    <input type="hidden" name="affiliateLinkId" value="@affiliateLink.Id" />
                                                    <button type="submit" class="Button-Gen-JS">Generuj skrypt</button>
                                                </form>
                                            </p>
                                            <p class="p-category">Banery JS</p>
                                        </td>
                                   

                                        <td><p class="p-product">@affiliateLink.ClickCount</p><p class="p-category">Kliknięcia w link</p></td>                                     
                                        <td><p class="p-product">@affiliateLink.ExactSoldProductsCount</p><p class="p-category">Sprzedane produkty</p></td>
                                        <td>
                                            <p class="p-product">@((affiliateLink.SoldValue ?? 0).ToString("N2")) zł</p>
                                            <p class="p-category">Zarobek</p>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
</div>

<div id="editCampaignModal" class="modal">
    <div class="modal-content">

       <div class="Campaign-Container-Title">Edytuj nazwę kampanii</div>
        <input type="text" id="newCampaignName" placeholder="Nowa nazwa kampanii" maxlength="32">
        <div class="Campaign-Container-Title">

            <button class="Button-Page-Small" onclick="closeModal()">Anuluj</button>
            <button class="Button-Page-Small-b" onclick="saveNewCampaignName()">Zapisz</button>
        </div>

    </div>
</div>

<div id="alertContainer" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1031; right: 0; bottom: 0;"></div>

<script>
    var campaignsDataUrl = '@Url.Action("GetCampaignData", "Campaign")';
</script>

<script src="/js/Affiliate/campaign.min.js"></script>