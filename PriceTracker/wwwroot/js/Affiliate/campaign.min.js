function deleteCampaign(n){confirm("Czy na pewno chcesz usunąć tę kampanię?")&&fetch(`/Campaign/DeleteCampaign?campaignId=${n}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify({campaignId:n})}).then(n=>n.json()).then(n=>{n.success?(alert("Kampania została usunięta."),location.reload()):alert(n.message)}).catch(n=>{console.error("Wystąpił błąd:",n)})}function editCampaignName(n,t){currentCampaignId=t;document.getElementById("editCampaignModal").style.display="block"}function closeModal(){document.getElementById("editCampaignModal").style.display="none"}function saveNewCampaignName(){let n=document.getElementById("newCampaignName").value;fetch(`/Campaign/UpdateCampaignName?campaignId=${currentCampaignId}&campaignName=${encodeURIComponent(n)}`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(n=>n.json()).then(n=>{n.success?(alert("Nazwa kampanii została zaktualizowana."),location.reload()):alert(n.message)}).catch(n=>{console.error("Wystąpił błąd:",n)});closeModal()}function calculateCampaigns(){let n=0;document.querySelectorAll(".campaign-wrapper").forEach(()=>{n++});document.getElementById("campaignCount").innerText=`${n}/${20}`}function toggleTable(n){const t=n.nextElementSibling,i=n.querySelector(".toggle-text");t.style.display==="none"?(t.style.display="block",n.classList.add("expanded"),n.classList.add("campaign-box-expanded"),i.textContent="Zwiń"):(t.style.display="none",n.classList.remove("expanded"),n.classList.remove("campaign-box-expanded"),i.textContent="Rozwiń")}function drag(n){draggedItem=n.target.closest(".campaign-wrapper");setTimeout(()=>{draggedItem.classList.add("dragged-item")},0)}function dragOver(n){n.preventDefault();let t=n.target.closest(".campaign-wrapper");draggedItem!==t&&(isBefore(draggedItem,t)?t.before(draggedItem):t.after(draggedItem))}function isBefore(n,t){if(n.parentNode===t.parentNode)for(let i=n.previousSibling;i;i=i.previousSibling)if(i===t)return!0;return!1}function dragLeave(n){n.target.closest(".campaign-wrapper").classList.remove("over")}function endDrag(){draggedItem.classList.remove("dragged-item");let n=document.querySelectorAll(".over");n.forEach(n=>n.classList.remove("over"))}function drop(n){n.preventDefault();let t=n.target.closest(".campaign-wrapper");t.style.transform="";t.after(draggedItem);saveOrder();let i=document.querySelectorAll(".over");i.forEach(n=>{n.style.transform="",n.classList.remove("over")})}function allowDrop(n){n.preventDefault()}function saveOrder(){const n=Array.from(document.querySelectorAll(".campaign-wrapper")).map(n=>n.getAttribute("data-campaign-id"));fetch("/Campaign/UpdateOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(n=>n.json()).then(n=>{n.success||alert("Wystąpił błąd podczas aktualizacji kolejności kampanii.")}).catch(n=>{console.error("Wystąpił błąd:",n)})}function loadOrder(){const n=JSON.parse(localStorage.getItem("campaignOrder"));if(n){const t=document.getElementById("campaign-container"),r=document.querySelectorAll(".campaign-wrapper"),i=Array.from(r);t.innerHTML="";n.forEach(n=>{const r=i.find(t=>t.querySelector(".campaign-box span").textContent===n);r&&t.appendChild(r)});i.forEach(n=>{t.contains(n)||t.appendChild(n)})}}function updateCampaignRowAndChart(n){var t=document.querySelector(`.campaign-wrapper[data-campaign-id='${n.campaignId}']`),i,r,u,f;if(t){const c=t.querySelector(".campaign-box-head-name");t.querySelector(".click-data").textContent=n.click;t.querySelector(".full-click-data").textContent=n.fullClick;t.querySelector(".orders-data").textContent=n.orders;t.querySelector(".full-orders-data").textContent=n.fullOrders;t.querySelector(".earnings-data").textContent=n.earnings.toFixed(2)+" zł";t.querySelector(".full-earnings-data").textContent=n.fullEarnings.toFixed(2)+" zł";c&&(c.textContent=n.campaignName);t.setAttribute("data-creation-date",n.creationDate);i=new Date(n.creationDate);r=i.toLocaleDateString("pl-PL",{year:"numeric",month:"long",day:"numeric"});t.querySelector(".creationDate-data").textContent=r;u=updateOrdersToClicksRatio(n.orders,n.click);t.querySelector(".ordersToClicksRatio").textContent=u;f=updateFullOrdersToClicksRatio(n.fullOrders,n.fullClick);t.querySelector(".fullOrdersToClicksRatio").textContent=f;var e=n.clicks.map(n=>n.clickTime.substring(0,10)),o=n.clicks.map(n=>n.count),s=n.sales.map(n=>n.amount),h=t.querySelector(".chart-container-cam canvas").getContext("2d");createChart(h,e,o,s)}}function createChart(n,t,i,r){var u=n.createLinearGradient(0,0,0,n.canvas.clientHeight),f,e;u.addColorStop(0,"rgba(14, 126, 135, 0.2)");u.addColorStop(1,"rgba(14, 126, 135, 0.6)");f=n.createLinearGradient(0,0,0,n.canvas.clientHeight);f.addColorStop(0,"rgba(246, 80, 99, 1");f.addColorStop(1,"rgba(247, 128, 95, 1)");e=new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"Zarobki",data:r,barThickness:10,backgroundColor:"rgba(255, 255, 255, 0.6)",borderColor:"rgba(255, 255, 255, 0.6)",borderWidth:1,borderRadius:2,yAxisID:"yEarnings"},{label:"Ruch na stronę",data:i,type:"line",backgroundColor:u,borderColor:"rgba(14, 126, 135, 1)",borderWidth:2,fill:!0,tension:.5,yAxisID:"yClicks"}]},options:{maintainAspectRatio:!1,scales:{x:{display:!1,offset:!1,grid:{color:"rgba(255, 255, 255, 0.8)"}},yClicks:{display:!0,type:"linear",position:"left",beginAtZero:!0,suggestedMax:100,title:{display:!1,text:"Ruch",color:"rgba(255, 255, 255, 0.8",font:{size:12,weight:"regular"}},ticks:{color:"rgba(255, 255, 255, 0.8"}},yEarnings:{display:!0,type:"linear",position:"right",color:"rgba(255, 255, 255, 0.8)",beginAtZero:!1,suggestedMax:100,grid:{drawOnChartArea:!1},title:{display:!1,text:"Zarobki",color:"rgba(255, 255, 255, 0.8)",font:{size:12,weight:"regular"}},ticks:{color:"rgba(255, 255, 255, 0.8",callback:function(n){return n.toFixed(2)+" zł"}}}},elements:{point:{radius:0,hoverRadius:6,hoverBorderWidth:2}},plugins:{legend:{display:!1,labels:{color:"rgba(0, 69, 82, 1)",font:{size:15}}},tooltip:{mode:"index",intersect:!1,callbacks:{label:function(n){var t=n.dataset.label||"",i=n.parsed.y;return t==="Zarobki"?t+": "+parseFloat(i).toFixed(2)+" zł":t+": "+i}}}}}})}function updateOrdersToClicksRatio(n,t){var i=0;return t>0&&(i=n/t*100),i.toFixed(2)+" %"}function updateFullOrdersToClicksRatio(n,t){var i=0;return t>0&&(i=n/t*100),i.toFixed(2)+" %"}function copyToClipboard(n){var t=document.createElement("textarea"),i,r;t.value=n;t.style.position="fixed";t.style.left="0";t.style.top="0";t.style.opacity="0";document.body.appendChild(t);t.focus();t.select();try{i=document.execCommand("copy");r=i?"Skopiowano: "+n:"Nie udało się skopiować.";showCopyAlert(r,i?"success":"danger")}catch(u){showCopyAlert("Nie udało się skopiować. "+u,"danger")}document.body.removeChild(t)}function showCopyAlert(n,t){const i=document.getElementById("alertContainer");i.innerHTML="";const r=document.createElement("div");r.innerHTML=[`<div class="alert alert-${t} d-flex align-items-center justify-content-center" role="alert" style="min-height: 50px; width: auto; color: #FFF; background: rgba(14, 126, 135, 0.76);  padding: 0.4rem 1.2rem;">`,`   <div class="text-center">${n}</div>`,"<\/div>"].join("");i.append(r);i.style.position="fixed";i.style.left="50%";i.style.bottom="50px";i.style.transform="translateX(-40%)";i.style.display="flex";i.style.justifyContent="center";i.style.alignItems="center";setTimeout(()=>{r.remove()},3e3)}$(document).ready(function(){$("#campaignSearch").on("keyup",function(){var n=$(this).val().toLowerCase();$(".campaign-wrapper").filter(function(){$(this).toggle($(this).find(".campaign-box-head-name").text().toLowerCase().indexOf(n)>-1)})})});let currentCampaignId=null;window.onload=calculateCampaigns;let draggedItem=null;document.querySelectorAll(".campaign-wrapper").forEach(n=>{n.addEventListener("dragover",dragOver),n.addEventListener("dragleave",dragLeave)});document.addEventListener("DOMContentLoaded",function(){fetch(campaignsDataUrl).then(n=>n.json()).then(n=>{n.forEach(n=>{updateCampaignRowAndChart(n)})})});