document.addEventListener("DOMContentLoaded", (function () { let e, t = [], n = null, r = "", o = 2, i = 2, a = null, s = "", c = new Set, l = { sortName: null, sortPrice: null, sortRaiseAmount: null, sortRaisePercentage: null, sortLowerAmount: null, sortLowerPercentage: null, sortMarginAmount: null, sortMarginPercentage: null, showRejected: !1 }; function d(e, t) { let n; return function (...r) { const o = this; clearTimeout(n), n = setTimeout((() => e.apply(o, r)), t) } } e = document.getElementById("positionRangeSlider"); var u = document.getElementById("positionRange"); noUiSlider.create(e, { start: [1, 16], connect: !0, range: { min: 1, max: 16 }, step: 1, format: wNumb({ decimals: 0 }) }), e.noUiSlider.on("update", (function (e, t) { const n = e.map((e => 16 === parseInt(e) ? "Schowany" : "Msc " + e)); u.textContent = n.join(" - ") })), e.noUiSlider.on("change", (function () { M() })), e.noUiSlider.on("change", (function () { M() })); const m = d((function () { const e = document.getElementById("usePriceDifference").checked; t.forEach((t => { t.valueToUse = e ? null !== t.savings ? t.savings : t.priceDifference : t.percentageDifference, t.colorClass = v(t.valueToUse, t.isUniqueBestPrice, t.isSharedBestPrice) })), M() }), 300); const g = document.getElementById("usePriceDifference"), p = document.getElementById("unitLabel1"), f = document.getElementById("unitLabel2"); function h(e) { e ? (p.textContent = "PLN", f.textContent = "PLN") : (p.textContent = "%", f.textContent = "%") } function y() { fetch(`/PriceHistory/GetPrices?storeId=${storeId}&competitorStore=${s}`).then((e => e.json())).then((e => { r = e.myStoreName, o = e.setPrice1, i = e.setPrice2, missedProductsCount = e.missedProductsCount; const n = e.usePriceDiff; document.getElementById("usePriceDifference").checked = n, h(n), t = e.prices.map((e => { const t = e.isRejected; let r = null, o = "", i = null, a = null, s = null, c = null, l = "", d = ""; return t ? o = "prRejected" : (r = n ? null !== e.savings ? e.savings : e.priceDifference : e.percentageDifference, o = v(r, e.isUniqueBestPrice, e.isSharedBestPrice), i = null == e.marginPrice || isNaN(e.marginPrice) ? null : parseFloat(e.marginPrice), a = null == e.myPrice || isNaN(e.myPrice) ? null : parseFloat(e.myPrice), null != i && null != a && (s = a - i, c = 0 !== i ? s / i * 100 : null, l = s >= 0 ? "+" : "-", d = s >= 0 ? "priceBox-diff-margin" : "priceBox-diff-margin-minus")), { ...e, isRejected: t, valueToUse: r, colorClass: o, marginPrice: i, myPrice: a, marginAmount: s, marginPercentage: c, marginSign: l, marginClass: d } })), document.getElementById("totalPriceCount").textContent = e.priceCount, document.getElementById("price1").value = o, document.getElementById("price2").value = i, document.getElementById("missedProductsCount").textContent = missedProductsCount, L(t); const a = document.getElementById("productSearch").value; let s = t; a && (s = s.filter((e => { const t = a.replace(/[^a-zA-Z0-9\s.-]/g, "").trim().toLowerCase().replace(/\s+/g, ""); return e.productName.toLowerCase().replace(/[^a-zA-Z0-9\s.-]/g, "").replace(/\s+/g, "").includes(t) }))), s = P(s), E(s), b(s), C(s), function () { const e = t.some((e => null !== e.marginAmount && null !== e.marginPercentage)), n = document.getElementById("sortMarginAmount"), r = document.getElementById("sortMarginPercentage"); e ? (n.style.display = "", r.style.display = "") : (n.style.display = "none", r.style.display = "none") }() })).catch((e => console.error("Error fetching prices:", e))) } function L(e) { const t = {}; let n = 0; e.forEach((e => { 0 === e.flagIds.length && n++, e.flagIds.forEach((e => { t[e] || (t[e] = 0), t[e]++ })) })); const r = document.getElementById("flagContainer"); r.innerHTML = "", flags.forEach((e => { const n = t[e.FlagId] || 0, o = `\n            <div class="form-check">\n                <input class="form-check-input flagFilter" type="checkbox" id="flagCheckbox_${e.FlagId}" value="${e.FlagId}" ${c.has(e.FlagId.toString()) ? "checked" : ""}>\n                <label class="form-check-label" for="flagCheckbox_${e.FlagId}">${e.FlagName} (${n})</label>\n            </div>\n        `; r.innerHTML += o })); const o = `\n        <div class="form-check">\n            <input class="form-check-input flagFilter" type="checkbox" id="noFlagCheckbox" value="noFlag" ${c.has("noFlag") ? "checked" : ""}>\n            <label class="form-check-label" for="noFlagCheckbox">Brak flagi (${n})</label>\n        </div>\n        `; r.innerHTML += o, document.querySelectorAll(".flagFilter").forEach((e => { e.addEventListener("change", (function () { const e = this.value; this.checked ? c.add(e) : c.delete(e), M() })) })) } function P(t) { const n = document.getElementById("category").value, r = Array.from(document.querySelectorAll(".colorFilter:checked")).map((e => e.value)), o = document.getElementById("bidFilter").checked, i = Array.from(document.querySelectorAll(".deliveryFilterMyStore:checked")).map((e => parseInt(e.value))), a = Array.from(document.querySelectorAll(".deliveryFilterCompetitor:checked")).map((e => parseInt(e.value))), s = Array.from(document.querySelectorAll(".externalPriceFilter:checked")).map((e => e.value)), l = e.noUiSlider.get(), d = parseInt(l[0]), u = parseInt(l[1]); let m = n ? t.filter((e => e.category === n)) : t; return m = m.filter((e => { const t = null === e.myPosition ? 16 : parseInt(e.myPosition); return t >= d && t <= u })), r.length && (m = m.filter((e => r.includes(e.colorClass)))), c.has("noFlag") ? m = m.filter((e => 0 === e.flagIds.length)) : c.size > 0 && (m = m.filter((e => Array.from(c).some((t => e.flagIds.includes(parseInt(t))))))), o && (m = m.filter((e => "1" === e.myIsBidding))), i.length && (m = m.filter((e => i.includes(e.myDelivery)))), a.length && (m = m.filter((e => a.includes(e.delivery)))), s.includes("yes") ? m = m.filter((e => null !== e.externalPrice)) : s.includes("no") && (m = m.filter((e => null === e.externalPrice))), m } function v(e, t = !1, n = !1) { return t && e <= o ? "prIdeal" : t ? "prToLow" : n || e <= 0 ? "prGood" : e < i ? "prMid" : "prToHigh" } function E(e) { const t = document.getElementById("priceContainer"), n = document.getElementById("productSearch").value.trim(); t.innerHTML = "", e.forEach((e => { const o = e.isRejected, i = function (e, t) { if (!t) return e; const n = t.replace(/[^a-zA-Z0-9\s/.-]/g, "").replace(/\s+/g, ""); let r = 0, o = ""; for (let t = 0; t < e.length; t++) { const i = e[t].toLowerCase(); if (n[r] === i.replace(/\s+/g, "") || n[r] === e[t].replace(/\s+/g, "") ? (o += `<span style="color: #9400D3;font-weight: 600;">${e[t]}</span>`, r++) : o += e[t], r >= n.length) { o += e.slice(t + 1); break } } return o }(e.productName, n), s = "1" === e.isBidding, c = I(e.delivery); let l = null, d = null, u = null, m = null, g = null, p = null, f = null, h = "", y = "", L = null, P = null, v = null; o || (l = null != e.percentageDifference ? e.percentageDifference.toFixed(2) : "N/A", d = null != e.priceDifference ? e.priceDifference.toFixed(2) : "N/A", u = null != e.savings ? e.savings.toFixed(2) : "N/A", m = "1" === e.myIsBidding, g = I(e.myDelivery), p = e.marginAmount, f = e.marginPercentage, h = e.marginSign, y = e.marginClass, L = e.marginPrice, P = e.myPrice, v = e.myPosition); const E = document.createElement("div"); E.className = "price-box " + e.colorClass, E.dataset.detailsUrl = "/PriceHistory/Details?scrapId=" + e.scrapId + "&productId=" + e.productId, E.dataset.productId = e.productId, E.addEventListener("click", (function () { window.open(this.dataset.detailsUrl, "_blank") })); const b = document.createElement("div"); b.className = "price-box-space"; const C = document.createElement("div"); C.className = "price-box-column-name", C.innerHTML = i; const M = document.createElement("div"); if (M.className = "price-box-column-category", M.innerHTML = e.category, e.externalId) { const t = document.createElement("span"); t.className = "ApiBox", t.innerHTML = "API ID " + e.externalId, M.appendChild(t) } const x = document.createElement("button"); x.className = "assign-flag-button", x.dataset.productId = e.productId, x.innerHTML = "+ Przypisz flagi", x.style.pointerEvents = "auto", x.addEventListener("click", (function (e) { e.stopPropagation(), a = this.dataset.productId, B.style.display = "block", fetch(`/ProductFlags/GetFlagsForProduct?productId=${a}`).then((e => e.json())).then((e => { document.querySelectorAll(".flagCheckbox").forEach((t => { t.checked = e.includes(parseInt(t.value)) })) })).catch((e => console.error("Błąd pobierania flag dla produktu:", e))) })), b.appendChild(C), b.appendChild(x); const N = document.createElement("div"); N.className = "price-box-data"; const A = document.createElement("div"); A.className = "color-bar " + e.colorClass; const w = document.createElement("div"); w.className = "price-box-column"; const T = document.createElement("div"); T.className = "price-box-column-text", T.innerHTML = '<span style="font-weight: 500;">' + e.lowestPrice.toFixed(2) + " PLN</span><br>" + e.storeName; const F = document.createElement("div"); F.className = "price-box-column-text", F.innerHTML = (s ? '<span class="Bidding">Bid</span>' : "") + (null !== e.position ? '<span class="Position">Msc ' + e.position + "</span>" : '<span class="Position" style="background-color: #4B0089;">Schowany</span>') + (null != e.delivery ? '<span class="' + c + '">Wysyłka w ' + (1 == e.delivery ? "1 dzień" : e.delivery + " dni") + "</span>" : ""), w.appendChild(T), w.appendChild(F); const S = document.createElement("div"); if (S.className = "price-box-column", o || null == P) { const e = document.createElement("div"); e.className = "price-box-column-text", e.innerHTML = '<span style="font-weight: 500;">Brak ceny</span><br>' + r, S.appendChild(e) } else { const t = document.createElement("div"); t.className = "price-box-column-text", t.innerHTML = '<span style="font-weight: 500;">' + P.toFixed(2) + " PLN</span><br>" + r; const n = document.createElement("div"); n.className = "price-box-column-text", n.innerHTML = (m ? '<span class="Bidding">Bid</span>' : "") + (null !== v ? '<span class="Position">Msc ' + v + "</span>" : '<span class="Position" style="background-color: #4B0089;">Schowany</span>') + (null != e.myDelivery ? '<span class="' + g + '">Wysyłka w ' + (1 == e.myDelivery ? "1 dzień" : e.myDelivery + " dni") + "</span>" : ""), S.appendChild(t), S.appendChild(n) } const H = document.createElement("div"); if (H.className = "price-box-column-action", H.innerHTML = "", o) H.innerHTML += '<div class="rejected-product">Produkt odrzucony</div>'; else { if (null != L) { const e = L.toLocaleString("pl-PL", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " PLN"; if (null != P) { const t = h + Math.abs(p).toLocaleString("pl-PL", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " PLN", n = "(" + h + Math.abs(f).toLocaleString("pl-PL", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + "%)"; H.innerHTML += '<div class="' + y + '"><p>Cena zakupu: ' + e + "</p><p>Marża: " + t + " " + n + "</p></div>" } else H.innerHTML += '<div class="' + y + '"><p>Cena zakupu: ' + e + "</p></div>" } if ("prToLow" === e.colorClass || "prIdeal" === e.colorClass) { const t = e.colorClass + " priceBox-diff"; if (null != u && null != l) { const e = (u >= 0 ? "+" : "") + u.toLocaleString("pl-PL", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " PLN", n = "(" + (l >= 0 ? "+" : "") + l.toLocaleString("pl-PL", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + "%)"; H.innerHTML += '<div class="' + t + '">Podnieś: ' + e + " " + n + "</div>" } else H.innerHTML += '<div class="' + t + '">Podnieś: N/A</div>' } else if ("prMid" === e.colorClass || "prToHigh" === e.colorClass) { const t = e.colorClass + " priceBox-diff"; if (null != d && null != l) { const e = (d >= 0 ? "-" : "") + Math.abs(d).toLocaleString("pl-PL", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " PLN", n = "(" + (l >= 0 ? "-" : "") + Math.abs(l).toLocaleString("pl-PL", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + "%)"; H.innerHTML += '<div class="' + t + '">Obniż: ' + e + " " + n + "</div>" } else H.innerHTML += '<div class="' + t + '">Obniż: N/A</div>' } else if ("prGood" === e.colorClass) { const t = e.colorClass + " priceBox-diff-top"; H.innerHTML += '<div class="' + t + '">Jesteś w najlepszych cenach</div>' } } const D = document.createElement("div"); if (D.className = "price-box-column-api", !o && null !== e.externalPrice) { const t = (e.externalPrice - e.myPrice).toFixed(2), n = (e.externalPrice > e.myPrice ? "+" : "") + t; D.innerHTML = '<div class="price-box-column-text-api">Nowa cena: ' + e.externalPrice.toFixed(2) + ' PLN</div><div class="price-box-column-text-api">Zmiana: ' + n + " PLN</div>" } const R = k(e); if (N.appendChild(A), e.imgUrl) { const t = document.createElement("img"); t.dataset.src = e.imgUrl, t.alt = e.productName, t.className = "lazy-load", t.style.width = "84px", t.style.height = "84px", t.style.marginRight = "14px", t.style.marginLeft = "16px", t.style.backgroundColor = "#ffffff", t.style.display = "block", N.appendChild(t) } N.appendChild(w), N.appendChild(S), N.appendChild(H), o || null === e.externalPrice || N.appendChild(D), N.appendChild(R), E.appendChild(b), E.appendChild(M), E.appendChild(N), t.appendChild(E) })), document.getElementById("displayedProductCount").textContent = e.length; const o = document.querySelectorAll(".lazy-load"), i = new Map, s = new IntersectionObserver(((e, t) => { e.forEach((e => { const n = e.target, r = [...o].indexOf(n); if (e.isIntersecting) { const e = setTimeout((() => { !function (e) { const t = 6, n = Math.max(0, e - t), r = Math.min(o.length - 1, e + t); for (let e = n; e <= r; e++) { const t = o[e]; t.src || (t.src = t.dataset.src, t.onload = () => { t.classList.add("loaded") }) } }(r), t.unobserve(n), i.delete(n) }), 100); i.set(n, e) } else i.has(n) && (clearTimeout(i.get(n)), i.delete(n)) })) }), { root: null, rootMargin: "50px", threshold: .01 }); o.forEach((e => { s.observe(e) })) } function I(e) { return e <= 1 ? "Availability1Day" : e <= 3 ? "Availability3Days" : e <= 7 ? "Availability7Days" : "Availability14Days" } g.addEventListener("change", (function () { h(g.checked) })); const b = d((function (e) { const t = { prGood: 0, prMid: 0, prToHigh: 0, prIdeal: 0, prToLow: 0 }; e.forEach((e => { e.isRejected || t[e.colorClass]++ })); const r = [t.prToHigh, t.prMid, t.prGood, t.prIdeal, t.prToLow]; if (n) n.data.datasets[0].data = r, n.update(); else { const e = document.getElementById("colorChart").getContext("2d"); n = new Chart(e, { type: "doughnut", data: { labels: ["Zawyżona", "Suboptymalna", "Konkurencyjna", "Strategiczna", "Zaniżona"], datasets: [{ data: r, backgroundColor: ["rgba(171, 37, 32, 0.8)", "rgba(224, 168, 66, 0.8)", "rgba(117, 152, 112, 0.8)", "rgba(0, 145, 123, 0.8)", "rgba(6, 6, 6, 0.8)"], borderColor: ["rgba(171, 37, 32, 1)", "rgba(224, 168, 66, 1)", "rgba(117, 152, 112, 1)", "rgba(0, 145, 123, 1)", "rgba(6, 6, 6, 1)"], borderWidth: 1 }] }, options: { aspectRatio: 1, plugins: { legend: { display: !1, position: "right", labels: { usePointStyle: !0, padding: 16, generateLabels: function (e) { const t = Chart.overrides.doughnut.plugins.legend.labels.generateLabels.call(this, e); return t.forEach((e => { e.text = "   " + e.text })), t } } }, tooltip: { callbacks: { label: function (e) { return "Produkty: " + e.parsed } } } } } }) } }), 600); function C(e) { const t = { prToHigh: 0, prMid: 0, prGood: 0, prIdeal: 0, prToLow: 0 }; e.forEach((e => { t[e.colorClass]++ })), document.querySelector('label[for="prToHighCheckbox"]').textContent = `Zawyżona (${t.prToHigh})`, document.querySelector('label[for="prMidCheckbox"]').textContent = `Suboptymalna (${t.prMid})`, document.querySelector('label[for="prGoodCheckbox"]').textContent = `Konkurencyjna (${t.prGood})`, document.querySelector('label[for="prIdealCheckbox"]').textContent = `Strategiczna (${t.prIdeal})`, document.querySelector('label[for="prToLowCheckbox"]').textContent = `Zaniżona (${t.prToLow})` } function M() { const e = document.getElementById("productSearch").value.toLowerCase().replace(/\s+/g, "").trim().replace(/[^a-zA-Z0-9\s/.-]/g, "").toLowerCase().replace(/\s+/g, ""); let n = t.filter((t => t.productName.toLowerCase().replace(/[^a-zA-Z0-9\s/.-]/g, "").replace(/\s+/g, "").includes(e))); n.sort(((t, n) => { const r = t.productName.toLowerCase().replace(/[^a-zA-Z0-9\s/.-]/g, "").replace(/\s+/g, ""), o = n.productName.toLowerCase().replace(/[^a-zA-Z0-9\s/.-]/g, "").replace(/\s+/g, ""), i = A(r, e), a = A(o, e); if (i !== a) return i - a; const s = w(r, e), c = w(o, e); return s !== c ? c - s : t.productName.localeCompare(n.productName) })), n = P(n), n = l.showRejected ? n.filter((e => e.isRejected)) : n.filter((e => !e.isRejected)), null !== l.sortName ? "asc" === l.sortName ? n.sort(((e, t) => e.productName.localeCompare(t.productName))) : n.sort(((e, t) => t.productName.localeCompare(e.productName))) : null !== l.sortPrice ? "asc" === l.sortPrice ? n.sort(((e, t) => e.lowestPrice - t.lowestPrice)) : n.sort(((e, t) => t.lowestPrice - e.lowestPrice)) : null !== l.sortRaiseAmount ? (n = n.filter((e => !e.isRejected && null !== e.savings)), "asc" === l.sortRaiseAmount ? n.sort(((e, t) => e.savings - t.savings)) : n.sort(((e, t) => t.savings - e.savings))) : null !== l.sortRaisePercentage ? (n = n.filter((e => !e.isRejected && null !== e.savings)), "asc" === l.sortRaisePercentage ? n.sort(((e, t) => e.percentageDifference - t.percentageDifference)) : n.sort(((e, t) => t.percentageDifference - e.percentageDifference))) : null !== l.sortLowerAmount ? (n = n.filter((e => !e.isRejected && null === e.savings && 0 !== e.priceDifference)), "asc" === l.sortLowerAmount ? n.sort(((e, t) => e.priceDifference - t.priceDifference)) : n.sort(((e, t) => t.priceDifference - e.priceDifference))) : null !== l.sortLowerPercentage ? (n = n.filter((e => !e.isRejected && null === e.savings && 0 !== e.priceDifference)), "asc" === l.sortLowerPercentage ? n.sort(((e, t) => e.percentageDifference - t.percentageDifference)) : n.sort(((e, t) => t.percentageDifference - e.percentageDifference))) : null !== l.sortMarginAmount ? (n = n.filter((e => null !== e.marginAmount)), "asc" === l.sortMarginAmount ? n.sort(((e, t) => e.marginAmount - t.marginAmount)) : n.sort(((e, t) => t.marginAmount - e.marginAmount))) : null !== l.sortMarginPercentage && (n = n.filter((e => null !== e.marginPercentage)), "asc" === l.sortMarginPercentage ? n.sort(((e, t) => e.marginPercentage - t.marginPercentage)) : n.sort(((e, t) => t.marginPercentage - e.marginPercentage))), E(n), b(n), C(n), L(n) } function x(e) { for (let t in l) if (t !== e) if ("showRejected" === t) { l[t] = !1; let e = document.getElementById("showRejectedButton"); e && e.classList.remove("active") } else { l[t] = null; let e = document.getElementById(t); e && (e.innerHTML = N(t), e.classList.remove("active")) } } function N(e) { switch (e) { case "sortName": return "A-Z"; case "sortPrice": return "Cena"; case "sortRaiseAmount": return "Podnieś PLN"; case "sortRaisePercentage": return "Podnieś %"; case "sortLowerAmount": return "Obniż PLN"; case "sortLowerPercentage": return "Obniż %"; case "sortMarginAmount": return "Marża PLN"; case "sortMarginPercentage": return "Marża %"; case "showRejected": return "Pokaż Odrzucone"; default: return "" } } function A(e, t) { return e.indexOf(t) } function w(e, t) { let n = 0; for (let r = 0; r < e.length; r++)for (let o = r; o <= e.length; o++) { const i = e.slice(r, o); t.includes(i) && i.length > n && (n = i.length) } return n } document.getElementById("showRejectedButton").addEventListener("click", (function () { l.showRejected = !l.showRejected, l.showRejected ? this.classList.add("active") : this.classList.remove("active"), x("showRejected"), M() })); const T = d((function () { M() }), 300); document.getElementById("productSearch").addEventListener("input", T), document.getElementById("category").addEventListener("change", (function () { M() })), document.querySelectorAll(".colorFilter, .flagFilter, .positionFilter, .deliveryFilterMyStore, .deliveryFilterCompetitor, .externalPriceFilter").forEach((function (e) { e.addEventListener("change", (function () { M() })) })), document.getElementById("bidFilter").addEventListener("change", (function () { M() })), document.getElementById("sortName").addEventListener("click", (function () { null === l.sortName ? (l.sortName = "asc", this.innerHTML = "A-Z ↑", this.classList.add("active")) : "asc" === l.sortName ? (l.sortName = "desc", this.innerHTML = "A-Z ↓", this.classList.add("active")) : (l.sortName = null, this.innerHTML = "A-Z", this.classList.remove("active")), x("sortName"), M() })), document.getElementById("sortPrice").addEventListener("click", (function () { null === l.sortPrice ? (l.sortPrice = "asc", this.innerHTML = "Cena ↑", this.classList.add("active")) : "asc" === l.sortPrice ? (l.sortPrice = "desc", this.innerHTML = "Cena ↓", this.classList.add("active")) : (l.sortPrice = null, this.innerHTML = "Cena", this.classList.remove("active")), x("sortPrice"), M() })), document.getElementById("sortRaiseAmount").addEventListener("click", (function () { null === l.sortRaiseAmount ? (l.sortRaiseAmount = "asc", this.innerHTML = "Podnieś PLN ↑", this.classList.add("active")) : "asc" === l.sortRaiseAmount ? (l.sortRaiseAmount = "desc", this.innerHTML = "Podnieś PLN ↓", this.classList.add("active")) : (l.sortRaiseAmount = null, this.innerHTML = "Podnieś PLN", this.classList.remove("active")), x("sortRaiseAmount"), M() })), document.getElementById("sortRaisePercentage").addEventListener("click", (function () { null === l.sortRaisePercentage ? (l.sortRaisePercentage = "asc", this.innerHTML = "Podnieś % ↑", this.classList.add("active")) : "asc" === l.sortRaisePercentage ? (l.sortRaisePercentage = "desc", this.innerHTML = "Podnieś % ↓", this.classList.add("active")) : (l.sortRaisePercentage = null, this.innerHTML = "Podnieś %", this.classList.remove("active")), x("sortRaisePercentage"), M() })), document.getElementById("sortLowerAmount").addEventListener("click", (function () { null === l.sortLowerAmount ? (l.sortLowerAmount = "asc", this.innerHTML = "Obniż PLN ↑", this.classList.add("active")) : "asc" === l.sortLowerAmount ? (l.sortLowerAmount = "desc", this.innerHTML = "Obniż PLN ↓", this.classList.add("active")) : (l.sortLowerAmount = null, this.innerHTML = "Obniż PLN", this.classList.remove("active")), x("sortLowerAmount"), M() })), document.getElementById("sortLowerPercentage").addEventListener("click", (function () { null === l.sortLowerPercentage ? (l.sortLowerPercentage = "asc", this.innerHTML = "Obniż % ↑", this.classList.add("active")) : "asc" === l.sortLowerPercentage ? (l.sortLowerPercentage = "desc", this.innerHTML = "Obniż % ↓", this.classList.add("active")) : (l.sortLowerPercentage = null, this.innerHTML = "Obniż %", this.classList.remove("active")), x("sortLowerPercentage"), M() })), document.getElementById("sortMarginAmount").addEventListener("click", (function () { null === l.sortMarginAmount ? (l.sortMarginAmount = "asc", this.innerHTML = "Marża PLN ↑", this.classList.add("active")) : "asc" === l.sortMarginAmount ? (l.sortMarginAmount = "desc", this.innerHTML = "Marża PLN ↓", this.classList.add("active")) : (l.sortMarginAmount = null, this.innerHTML = "Marża PLN", this.classList.remove("active")), x("sortMarginAmount"), M() })), document.getElementById("sortMarginPercentage").addEventListener("click", (function () { null === l.sortMarginPercentage ? (l.sortMarginPercentage = "asc", this.innerHTML = "Marża % ↑", this.classList.add("active")) : "asc" === l.sortMarginPercentage ? (l.sortMarginPercentage = "desc", this.innerHTML = "Marża % ↓", this.classList.add("active")) : (l.sortMarginPercentage = null, this.innerHTML = "Marża %", this.classList.remove("active")), x("sortMarginPercentage"), M() })), document.getElementById("usePriceDifference").addEventListener("change", (function () { const e = this.checked; t.forEach((t => { t.valueToUse = e ? null !== t.savings ? t.savings : t.priceDifference : t.percentageDifference, t.colorClass = v(t.valueToUse, t.isUniqueBestPrice, t.isSharedBestPrice) })), M() })), document.getElementById("price1").addEventListener("input", (function () { o = parseFloat(this.value), m() })), document.getElementById("price2").addEventListener("input", (function () { i = parseFloat(this.value), m() })), document.getElementById("savePriceValues").addEventListener("click", (function () { const e = parseFloat(document.getElementById("price1").value), t = parseFloat(document.getElementById("price2").value), n = document.getElementById("usePriceDifference").checked, r = { StoreId: storeId, SetPrice1: e, SetPrice2: t, UsePriceDiff: n }; fetch("/PriceHistory/SavePriceValues", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(r) }).then((e => e.json())).then((r => { r.success ? (o = e, i = t, usePriceDifferenceGlobal = n, y()) : alert("Error updating price values: " + r.message) })).catch((e => console.error("Błąd w aktualizowaniu wartości:", e))) })); const B = document.getElementById("flagModal"); function k(e) { const t = document.createElement("div"); return t.className = "flags-container", e.flagIds && e.flagIds.length > 0 && e.flagIds.forEach((function (e) { const n = flags.find((function (t) { return t.FlagId === e })); if (n) { const e = document.createElement("span"); e.className = "flag", e.style.color = n.FlagColor, e.style.border = "2px solid " + n.FlagColor, e.style.backgroundColor = function (e, t) { let n = 0, r = 0, o = 0; return 4 == e.length ? (n = parseInt(e[1] + e[1], 16), r = parseInt(e[2] + e[2], 16), o = parseInt(e[3] + e[3], 16)) : 7 == e.length && (n = parseInt(e[1] + e[2], 16), r = parseInt(e[3] + e[4], 16), o = parseInt(e[5] + e[6], 16)), `rgba(${n}, ${r}, ${o}, ${t})` }(n.FlagColor, .3), e.innerHTML = n.FlagName, t.appendChild(e) } })), t } document.getElementsByClassName("close")[0].onclick = function () { B.style.display = "none" }, window.onclick = function (e) { e.target == B && (B.style.display = "none") }, document.getElementById("saveFlagsButton").addEventListener("click", (function () { const e = Array.from(document.querySelectorAll(".flagCheckbox:checked")).map((e => parseInt(e.value))), n = { productId: a, flagIds: e }; fetch("/ProductFlags/AssignFlagsToProduct", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(n) }).then((e => e.json())).then((e => { e.success ? (B.style.display = "none", fetch(`/ProductFlags/GetFlagsForProduct?productId=${a}`).then((e => e.json())).then((e => { const n = parseInt(a), r = t.find((e => e.productId === n)); r ? r.flagIds = e : console.error("Product not found in allPrices:", a), function (e) { const n = parseInt(e), r = document.querySelector(`.price-box[data-product-id='${e}']`); if (r) { const o = r.querySelector(".flags-container"), i = t.find((e => e.productId === n)); if (i) { const e = k(i); o ? o.parentNode.replaceChild(e, o) : r.appendChild(e) } else console.error("Product not found in allPrices:", e) } }(a), L(t) })).catch((e => console.error("Error fetching updated flags for product:", e)))) : alert("Error assigning flags: " + e.message) })).catch((e => console.error("Error assigning flags:", e))) })), fetch(`/PriceHistory/GetStores?storeId=${storeId}`).then((e => e.json())).then((e => { const t = document.getElementById("competitorStoreSelect"); e.forEach((e => { const n = document.createElement("option"); n.value = e, n.text = e, t.appendChild(n) })), t.addEventListener("change", (function () { s = this.value, y() })) })).catch((e => console.error("Error fetching stores:", e))), y() }));