document.addEventListener("DOMContentLoaded",function(){function o(){const t=n.querySelectorAll(".input-group");e.style.display=t.length>=8?"none":"block";t.forEach(n=>{n.querySelector(".remove-btn").style.display=t.length>1?"block":"none"})}function c(n=""){var r=document.createElement("div"),t,i;return r.classList.add("input-group"),t=document.createElement("input"),t.type="text",t.name="ProductIdStores",t.classList.add("form-control"),t.value=n,i=document.createElement("button"),i.textContent="X",i.type="button",i.classList.add("remove-btn"),i.addEventListener("click",function(){r.remove();o()}),r.appendChild(t),r.appendChild(i),r}function r(t=""){if(!(n.querySelectorAll(".input-group").length>=8)){var i=c(t);n.appendChild(i);o()}}function s(){var n=parseFloat($("#ProductPrice").val()),i;!isNaN(n)&&n>0&&t!==null&&(i=n*(t/100),$("#AffiliateCommission").val(i.toFixed(2)))}function h(){var n=document.getElementById("productImageInput").value,t=document.getElementById("productImageDisplay");t.src=n?n:noPhotoUrl}var n=document.getElementById("productIdStoresContainer"),e=document.querySelector('button[onclick="addProductIdStore()"]'),t=null,i,f;e.addEventListener("click",function(){r()});const u=[...n.querySelectorAll('input[name="ProductIdStores"]')];u.length>0&&u.forEach(n=>n.remove());u.forEach(n=>r(n.value));n.querySelectorAll(".input-group").length===0&&r();i=document.querySelector("form");i.addEventListener("submit",function(t){const r=n.querySelectorAll('input[name="ProductIdStores"]'),u=Array.from(r).filter(n=>n.value.trim()!=="");r.forEach(n=>{n.value.trim()===""&&n.parentNode.remove()});u.length===0&&i.hasAttribute("action")&&i.getAttribute("action").includes("AddProduct")&&(t.preventDefault(),alert("Proszę dodać co najmniej jedno ID produktu w sklepie."))});document.getElementById("productImageInput").addEventListener("input",h);h();$("#storeDropdown").change(function(){var n=$(this).val();$.getJSON(`/ProductAssignment/GetCategories/${n}`,function(n){var t=$("#categoryDropdown");t.empty();t.append('<option value="">Wybierz kategorię<\/option>');$.each(n,function(n,i){t.append(`<option value="${i.categoryId}">${i.categoryName}</option>`)})})});$("#categoryDropdown").change(function(){var n=$(this).val();n&&$.getJSON(`/ProductAssignment/GetCategoryCommission/${n}`,function(n){n.commissionPercentage?(t=n.commissionPercentage,$("#categoryCommissionPercentage").text(t),s()):($("#categoryCommissionPercentage").text("brak danych"),t=null)})});$("#ProductPrice").on("input",function(){s()});f=$("#storeDropdown");f.find("option").length>1&&f.find("option:eq(1)").prop("selected",!0).change()});$(document).ready(function(){var n=$("#storeDropdown").val();n&&$("#storeDropdown").change()});