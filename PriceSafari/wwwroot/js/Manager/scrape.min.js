document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll("tbody tr"),o=e.length,t,i,f;document.getElementById("scrapableProductCount").textContent=o;t=document.getElementById("speedChart").getContext("2d");i=t.createLinearGradient(0,0,0,t.canvas.clientHeight);i.addColorStop(0,"rgba(14, 126, 135, 0.2)");i.addColorStop(1,"rgba(14, 126, 135, 0.6)");var n=new Chart(t,{type:"line",data:{labels:[],datasets:[{label:"Zebrane produkty na sekunde:",data:[],backgroundColor:i,borderColor:"rgba(14, 126, 135, 1)",borderWidth:2,fill:!0,tension:.5,pointRadius:0,pointHoverRadius:6,pointHoverBorderWidth:2}]},options:{maintainAspectRatio:!1,scales:{x:{type:"linear",position:"bottom",title:{display:!1,text:"Sekundy",color:"rgba(255, 255, 255, 0.8)"},grid:{color:"rgba(255, 255, 255, 0.2)"},ticks:{color:"rgba(255, 255, 255, 0.8)"}},y:{beginAtZero:!0,title:{display:!1,text:"Zebrane produkty",color:"rgba(255, 255, 255, 0.8)"},grid:{color:"rgba(255, 255, 255, 0.2)"},ticks:{color:"rgba(255, 255, 255, 0.8"}}},elements:{point:{radius:0,hoverRadius:6,hoverBorderWidth:2}},plugins:{legend:{display:!1,labels:{color:"rgba(0, 69, 82, 1)",font:{size:15}}},tooltip:{mode:"index",intersect:!1,callbacks:{label:function(n){var t=n.dataset.label||"",i=n.parsed.y;return t+": "+i}}}}}}),r=(new signalR.HubConnectionBuilder).withUrl("/scrapingHub").build(),u=!1;r.on("ReceiveProgressUpdate",function(t,i,r,f){var s,h,c;if(!u){var l=Math.round(t/i*100),e=document.getElementById("progressBarInner"),a=document.getElementById("progressText"),o=document.getElementById("completionMessage");e.style.width=l+"%";e.innerHTML=l+"%";a.innerHTML=`Zbieranie cen ${t}/${i} produktów (${f} odrzuconych)`;s=Math.floor(r);h=(t/r).toFixed(2);n.data.labels.length>0&&s===n.data.labels[n.data.labels.length-1]?(c=n.data.labels.length-1,n.data.datasets[0].data[c]=(parseFloat(n.data.datasets[0].data[c])+parseFloat(h))/2):(n.data.labels.push(s),n.data.datasets[0].data.push(parseFloat(h)));n.update();t===i&&(o.style.display="block",o.innerHTML=`Zebrano ceny dla ${t}/${i} produktów (${f} odrzuconych).`,o.style.color="#0E7E87",e.style.backgroundColor="#0E7E87",a.style.display="none",u=!0)}});r.start().catch(function(n){return console.error(n.toString())});f=document.querySelector(".Vert").dataset.storeId;$("#scrapingForm").on("submit",function(n){n.preventDefault();var i=$(this),t=i.attr("action");t=t.split("?")[0];$.ajax({url:t+"?storeId="+f,method:"GET",success:function(){console.log("Scraping started successfully")},error:function(){console.error("Error starting scraping")}})})});