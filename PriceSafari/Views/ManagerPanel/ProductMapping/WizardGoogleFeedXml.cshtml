@{
    Layout = "~/Views/Shared/_PanelLayout.cshtml";
    var storeId = ViewBag.StoreId ?? 0;
    string existingMappingsJson = ViewBag.ExistingMappings ?? "[]";
}

<h2>Wizard Mapping Google - storeId=@storeId</h2>

<div id="google-wizard-data"
     data-store-id="@storeId"
     data-existing-mappings='@Html.Raw(existingMappingsJson)'>
</div>

<div style="margin-bottom: 10px;">
    <form asp-action="ClearGoogleMappings"
          asp-controller="GoogleImportWizardXml"
          method="post"
          style="display:inline;">
        <input type="hidden" name="storeId" value="@storeId" />
        <button type="submit" style="background:red; color:white; padding:6px;">
            Usuń wszystkie mapowania
        </button>
    </form>


    <button id="extractProducts" style="margin-left:10px;">
        Wyciągnij produkty z XML (FRONT)
    </button>

    <button id="saveProductMapsInDb" style="margin-left:10px;">
        Zapisz w ProductMap
    </button>
</div>


<div>
    <label for="xmlFileInput">Wybierz zapisany plik XML/TXT:</label>
    <input type="file" id="xmlFileInput" accept=".xml,.txt">
    <button id="processXmlButton">Przetwórz wybrany plik</button>
</div>


<div id="urlParamsInfo" style="margin-bottom:10px; font-weight:bold;">
    Liczba URL zawierających parametry: 0
</div>

<div id="duplicatesInfo" style="margin-bottom:10px; font-weight:bold;">
</div>

<div style="margin-bottom: 10px;">
    <label>
        <input type="checkbox" id="removeDuplicateUrls">
        Usuń duplikaty URL (zostaw pierwszy wystąpienie)
    </label>
</div>

<div style="margin-bottom: 10px;">
    <label>
        <input type="checkbox" id="removeDuplicateEans">
        Usuń duplikaty EAN (zostaw pierwszy wystąpienie)
    </label>
</div>
<div style="margin-bottom: 10px;">
    <label>
        <input type="checkbox" id="onlyEanProducts" checked>
        Bierz tylko produkty z EAN
    </label>
</div>

<div id="finalNodesInfo" style="margin-bottom:10px; font-weight:bold;">
    Final nodes po filtrach: 0
</div>

<div style="margin-bottom: 10px;">
    <label>
        <input type="checkbox" id="cleanUrlParameters" checked>
        Usuń parametry URL (usuwamy wszystko od znaku "?")
    </label>
</div>

<div style="margin-bottom: 10px;">
    <label>Wybierz Pole: </label>
    <select id="fieldSelector">
        <option value="ExternalId">ExternalId</option>
        <option value="Url">Url</option>
        <option value="GoogleEan">GoogleEan</option>
        <option value="GoogleImage">GoogleImage</option>
        <option value="GoogleExportedName">GoogleExportedName</option>
        <option value="GoogleXMLPrice">GoogleXMLPrice</option>
        <option value="GoogleDeliveryXMLPrice">GoogleDeliveryXMLPrice</option>
    </select>
    <button id="saveMapping" style="margin-left:10px;">
        Zapisz Mapowanie
    </button>
    <button id="reloadMappings" style="margin-left:10px;">
        Załaduj mapowania
    </button>
</div>

<div style="display: flex; gap: 10px; width:100%;">

    <div style="flex: 1; border:1px solid #ccc; height:900px; overflow:auto; padding:5px;">
        <h4>Struktura XML</h4>
        <div id="xmlContainer"></div>
    </div>

    <div style="flex: 1; border:1px solid #ccc; height:900px; overflow:auto; padding:5px;">
        <h4>Mapa Pól i Podgląd</h4>

        <table id="mappingTable" border="1" cellpadding="5" style="border-collapse: collapse; width:100%;">
            <thead>
                <tr>
                    <th>Field</th>
                    <th>XPath</th>
                    <th>Liczba węzłów</th>
                    <th>Wartość pierwszego</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <pre id="productMapsPreview"
             style="border:1px solid #ccc; margin-top:10px; min-height:100px; padding:10px;">
        </pre>
    </div>
</div>

<script src="~/js/Manager/GoogleWizard.js"></script>

<style>

    .xml-node {
        cursor: pointer;
        margin: 3px 0;
    }

    .highlight-ExternalId {
        background-color: rgba(255, 0, 0, 0.1);
    }

    .highlight-Url {
        background-color: rgba(0, 255, 0, 0.1);
    }

    .highlight-GoogleEan {
        background-color: rgba(0, 0, 255, 0.1);
    }

    .highlight-GoogleImage {
        background-color: rgba(255, 165, 0, 0.1);
    }

    .highlight-GoogleExportedName {
        background-color: rgba(255, 255, 0, 0.2);
    }

    .highlight-GoogleXMLPrice {
        background-color: rgba(255, 192, 203, 0.2);
    }

    .highlight-GoogleDeliveryXMLPrice {
        background-color: rgba(255, 165, 0, 0.2);
    }

    #mappingTable {
        width: 100%;
    }

        #mappingTable th, #mappingTable td {
            padding: 4px 8px;
            text-align: left;
        }
</style>