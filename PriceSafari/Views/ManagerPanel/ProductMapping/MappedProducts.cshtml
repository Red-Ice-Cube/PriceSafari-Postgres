@model IEnumerable<PriceSafari.Models.ProductMap>
@{
    ViewData["Title"] = "Zmapowane Produkty";
    Layout = "~/Views/Shared/_PanelLayout.cshtml";
    var storeProducts = ViewBag.StoreProducts as IEnumerable<PriceSafari.Models.ProductClass>;
    var storeId = ViewBag.StoreId;

    var imageCount = storeProducts.Count(p => !string.IsNullOrEmpty(p.MainUrl));
    var productNameCount = storeProducts.Count(p => !string.IsNullOrEmpty(p.ProductName));
    var exportedNameCeneoCount = storeProducts.Count(p => !string.IsNullOrEmpty(p.ExportedNameCeneo));
    var offerUrlCount = storeProducts.Count(p => !string.IsNullOrEmpty(p.OfferUrl));
    var urlCount = storeProducts.Count(p => !string.IsNullOrEmpty(p.Url));
    var externalIdCount = storeProducts.Count(p => p.ExternalId.HasValue);
    var catalogNumberCount = storeProducts.Count(p => !string.IsNullOrEmpty(p.CatalogNumber));
    var eanCount = storeProducts.Count(p => !string.IsNullOrEmpty(p.Ean));
}

<h2>Zmapowane Produkty dla sklepu @ViewBag.StoreName</h2>

<!-- Przycisk do usuwania wszystkich produktów danego sklepu -->
<form asp-action="RemoveAllProductsForStore"
      asp-controller="ProductMapping"
      method="post"
      class="mt-3">
    <input type="hidden" name="storeId" value="@storeId" />
    <button type="submit" class="btn btn-danger">
        Usuń wszystkie produkty tego sklepu
    </button>
</form>

<!-- Przycisk do usuwania słowa z nazw produktów -->
<form asp-action="RemoveWordFromProductNamesCeneo" method="post" class="mt-3">
    <div class="form-group">
        <label for="wordToRemove">Słowo do usunięcia z nazw produktów:</label>
        <input type="text" class="form-control" id="wordToRemove" name="wordToRemove" placeholder="Wpisz słowo" required>
    </div>
    <button type="submit" class="btn btn-danger">Usuń słowo z nazw produktów</button>
</form>

<!-- Przycisk: Utwórz lub zaktualizuj produkty -->
<form asp-action="CreateOrUpdateProductsFromProductMap" method="post">
    <input type="hidden" name="storeId" value="@storeId" />

    <!-- Nowy checkbox: -->
    <div class="form-group mt-2">
        <label>
            <input type="checkbox" name="addGooglePrices" value="true" />
            Dodaj ceny Google (Price + Delivery)
        </label>
    </div>

    <button type="submit" class="btn btn-primary">
        Utwórz lub zaktualizuj produkty
    </button>
</form>

<!-- Przycisk: Mapuj Produkty -->
<form method="post" action="@Url.Action("MapProducts", "ProductMapping", new { storeId })">
    <button type="submit" class="btn btn-primary">Mapuj Produkty</button>
</form>

<div class="row">
    <div class="col-md-12 p-3">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Zdjęcie (@imageCount)</th>
                    <th>Produkt (@productNameCount)</th>
                    <th>Nazwa EXPORT CENEO (@exportedNameCeneoCount)</th>
                    <th>ceneo URL (@offerUrlCount)</th>
                    <th>URL (@urlCount)</th>
                    <th>External ID (@externalIdCount)</th>
                    <th>Numer Katalogowy (@catalogNumberCount)</th>
                    <th>EAN (@eanCount)</th>

                    <!-- NOWE: kolumny z feeda Google -->
                    <th>Cena z Feed Google</th>
                    <th>Dostawa z Feed Google</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var product in storeProducts)
                {
                    <tr>
                        <td>
                            @if (!string.IsNullOrEmpty(product.MainUrl))
                            {
                                <img src="@product.MainUrl" alt="@product.CatalogNumber" style="max-width: 100px;" />
                            }
                        </td>
                        <td>@product.ProductName</td>
                        <td>@product.ExportedNameCeneo</td>
                        <td>
                            @if (!string.IsNullOrEmpty(product.OfferUrl))
                            {
                                <a href="@product.OfferUrl" target="_blank">@product.OfferUrl</a>
                            }
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(product.Url))
                            {
                                <a href="@product.Url" target="_blank">@product.Url</a>
                            }
                        </td>
                        <td>@product.ExternalId</td>
                        <td>@product.CatalogNumber</td>
                        <td>@product.Ean</td>

                        <!-- NOWE: wypisanie cen z feeda Google, np. do 2 miejsc po przecinku -->
                        <td>
                            @(product.GoogleXMLPrice.HasValue
                                ? product.GoogleXMLPrice.Value.ToString("F2")
                                : "-")
                        </td>
                        <td>
                            @(product.GoogleDeliveryXMLPrice.HasValue
                                ? product.GoogleDeliveryXMLPrice.Value.ToString("F2")
                                : "-")
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
