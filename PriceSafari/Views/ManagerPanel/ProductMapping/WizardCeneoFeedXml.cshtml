@{
    Layout = "~/Views/Shared/_PanelLayout.cshtml";
    var storeId = ViewBag.StoreId ?? 0;
    string existingMappingsJson = ViewBag.ExistingMappings ?? "[]";
}

<h2>Wizard Mapping Ceneo - storeId=@storeId</h2>

<div style="margin-bottom: 10px;">
    <form asp-action="ClearCeneoMappings"
          asp-controller="CeneoImportWizardXml"
          method="post"
          style="display:inline;">
        <input type="hidden" name="storeId" value="@storeId" />
        <button type="submit" style="background:red; color:white; padding:6px;">
            Usuń wszystkie mapowania
        </button>
    </form>

    <button id="extractProducts" style="margin-left:10px;">
        Wyciągnij produkty z XML (FRONT)
    </button>

    <button id="saveProductMapsInDb" style="margin-left:10px;">
        Zapisz w ProductMap
    </button>
</div>

<div style="margin-bottom:10px; font-weight:bold;">
    <div id="urlParamsInfo">Liczba URL zawierających parametry: 0</div>
    <div id="duplicatesInfo">
    </div>
    <div>
        <label>
            <input type="checkbox" id="cleanUrlParameters" checked>
            Usuń parametry URL (wszystko od znaku "?")
        </label>
    </div>
    <div>
        <label>
            <input type="checkbox" id="removeDuplicateUrls">
            Usuń duplikaty URL (zostaw pierwsze wystąpienie)
        </label>
    </div>
    <div>
        <label>
            <input type="checkbox" id="removeDuplicateEans">
            Usuń duplikaty EAN (zostaw pierwsze wystąpienie)
        </label>
    </div>
    <div>
        <label>
            <input type="checkbox" id="removeDuplicateProducerCodes">
            Usuń duplikaty kodu producenta (zostaw pierwsze wystąpienie)
        </label>
    </div>
    <div>
        <label>
            <input type="checkbox" id="onlyEanProducts" checked>
            Bierz tylko produkty z EAN
        </label>
    </div>
    <div id="finalNodesInfo">Final nodes po filtrach: 0</div>
</div>

<div style="margin-bottom: 10px;">
    <label>Wybierz Pole: </label>
    <select id="fieldSelector">
        <option value="ExternalId">ID z sklepu</option>
        <option value="Url">Url oferty Ceneo</option>
        <option value="CeneoEan">EAN Ceneo</option>
        <option value="CeneoImage">URL Obrazu</option>
        <option value="CeneoExportedName">Nazwa produktu</option>
        <option value="CeneoExportedProducer">Nazwa producenta</option>
        <option value="CeneoExportedProducerCode">Kod producenta</option>
        <option value="CeneoXMLPrice">Cena XML (Ceneo)</option>
        <option value="CeneoDeliveryXMLPrice">Dostawa cena XML (Ceneo)</option>
    </select>

    <button id="saveMapping" style="margin-left:10px;">Zapisz Mapowanie</button>
    <button id="reloadMappings" style="margin-left:10px;">Załaduj mapowania</button>
</div>

<div style="display: flex; gap: 10px; width:100%;">
    <div style="flex: 1; border:1px solid #ccc; height:900px; overflow:auto; padding:5px;">
        <h4>Struktura XML</h4>
        <div id="xmlContainer"></div>
    </div>
    <div style="flex: 1; border:1px solid #ccc; height:900px; overflow:auto; padding:5px;">
        <h4>Mapa Pól i Podgląd</h4>
        <table id="mappingTable" border="1" cellpadding="5" style="border-collapse: collapse; width:100%;">
            <thead>
                <tr>
                    <th>Field</th>
                    <th>XPath</th>
                    <th>Liczba węzłów</th>
                    <th>Wartość pierwszego</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <pre id="productMapsPreview" style="border:1px solid #ccc; margin-top:10px; min-height:100px; padding:10px;"></pre>
    </div>
</div>

<div id="ceneo-wizard-data"
     data-store-id="@storeId"
     data-existing-mappings='@Html.Raw(existingMappingsJson)'>
</div>

<script src="~/js/Manager/CeneoWizard.js"></script>

<style>
    .xml-node {
        cursor: pointer;
        margin: 3px 0;
    }

    .highlight-ExternalId {
        background-color: rgba(255, 0, 0, 0.1);
    }

    .highlight-Url {
        background-color: rgba(0, 255, 0, 0.1);
    }

    .highlight-CeneoEan {
        background-color: rgba(0, 0, 255, 0.1);
    }

    .highlight-CeneoImage {
        background-color: rgba(255, 165, 0, 0.1);
    }

    .highlight-CeneoExportedName {
        background-color: rgba(255, 255, 0, 0.2);
    }

    .highlight-CeneoExportedProducer {
        background-color: rgba(17, 205, 255, 0.1);
    }
    /* NOWY STYL */
    .highlight-CeneoExportedProducerCode {
        background-color: rgba(128, 0, 128, 0.1);
    }

    .highlight-CeneoXMLPrice {
        background-color: rgba(255, 192, 203, 0.2);
    }

    .highlight-CeneoDeliveryXMLPrice {
        background-color: rgba(255, 165, 0, 0.2);
    }

    #mappingTable {
        width: 100%;
    }

        #mappingTable th, #mappingTable td {
            padding: 4px 8px;
            text-align: left;
        }
</style>