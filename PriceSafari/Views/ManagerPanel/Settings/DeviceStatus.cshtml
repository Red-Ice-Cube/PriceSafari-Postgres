@model List<PriceSafari.Models.DeviceStatus>

@{
    Layout = "~/Views/Shared/_PanelLayout.cshtml";

    var distinctDeviceNames = Model
        .Where(m => !string.IsNullOrWhiteSpace(m.DeviceName))
        .Select(m => m.DeviceName)
        .Distinct()
        .ToList();
}

<style>
    /* ... style bez zmian ... */
    .table-orders {
        width: 100%;
        border-collapse: collapse;
    }

    .bg-yes {
        background-color: #c6f6c6;
        color: #000;
        font-weight: bold;
    }

    .bg-no {
        background-color: #f9c6c6;
        color: #000;
        font-weight: bold;
    }

    .Vert-table {
        margin-top: 20px;
    }

    .sort-container {
        margin-bottom: 10px;
    }

        .sort-container select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #aaa;
        }

    .Button-ClearAll {
        margin-bottom: 10px;
        background-color: #ff6666;
        border: none;
        color: #fff;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
    }

        .Button-ClearAll:hover {
            background-color: #ff4c4c;
        }
</style>

<div class="Page-Box">
    <div class="Page-Box-Container">
        <div class="Page-Box-Category">
            <div class="Category-Box-Title">
                Statusy Maszyn
            </div>
            <partial name="_ManageNavCol" />
        </div>

        <div class="sort-container">
            <label for="deviceNameFilter">Maszyny</label>
            <select id="deviceNameFilter">
                <option value="">Wszystkie</option>
                @foreach (var name in distinctDeviceNames)
                {
                    <option value="@name">@name</option>
                }
            </select>
        </div>

        <div class="Vert-table">
            <form asp-action="ClearAll" method="post"
                  onsubmit="return confirm('Czy na pewno chcesz usunąć wszystkie wpisy?');">
                <button type="submit" class="Button-ClearAll">Usuń wszystkie wpisy</button>
            </form>

            <table class="table-orders" id="deviceTable">
                <thead>
                    <tr>
                        <th>Nazwa urządzenia</th>
                        <th>Ostatni meldunek</th>
                        <th>Online</th>
                        <th>BaseScal</th>
                        <th>URL</th>
                        <th>Google Crawler</th>
                        <th>Ceneo Crawler</th>
                        <th>Allegro Scalanie</th>
                        <th>Allegro URL</th>
                        <th>Allegro Crawler</th>
                        <th>Allegro API Bot</th>
                        <th>Faktury (Generator)</th>
                        <th>Płatności (Worker)</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="td-deviceName">@item.DeviceName</td>
                            <td>@item.LastCheck</td>
                            <td class="@(item.IsOnline ? "bg-yes" : "bg-no")">
                                @(item.IsOnline ? "tak" : "nie")
                            </td>
                            <td class="@(item.BaseScalEnabled ? "bg-yes" : "bg-no")">
                                @(item.BaseScalEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.UrlScalEnabled ? "bg-yes" : "bg-no")">
                                @(item.UrlScalEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.GooCrawEnabled ? "bg-yes" : "bg-no")">
                                @(item.GooCrawEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.CenCrawEnabled ? "bg-yes" : "bg-no")">
                                @(item.CenCrawEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.AleBaseScalEnabled ? "bg-yes" : "bg-no")">
                                @(item.AleBaseScalEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.UrlScalAleEnabled ? "bg-yes" : "bg-no")">
                                @(item.UrlScalAleEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.AleCrawEnabled ? "bg-yes" : "bg-no")">
                                @(item.AleCrawEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.AleApiBotEnabled ? "bg-yes" : "bg-no")">
                                @(item.AleApiBotEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.InvoiceGeneratorEnabled ? "bg-yes" : "bg-no")">
                                @(item.InvoiceGeneratorEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.PaymentProcessorEnabled ? "bg-yes" : "bg-no")">
                                @(item.PaymentProcessorEnabled ? "tak" : "nie")
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const dropdown = document.getElementById('deviceNameFilter');
        const table = document.getElementById('deviceTable');
        const rows = Array.from(table.querySelectorAll('tbody tr'));

        dropdown.addEventListener('change', function () {
            const selectedName = dropdown.value.trim().toLowerCase();

            rows.forEach(row => {
                const deviceNameCell = row.querySelector('.td-deviceName');
                if (!deviceNameCell) return;

                const rowDeviceName = deviceNameCell.textContent.trim().toLowerCase();

                if (selectedName === "" || rowDeviceName === selectedName) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        });
    </script>
}