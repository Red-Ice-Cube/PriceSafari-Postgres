@model List<PriceSafari.Models.DeviceStatus>

@{
    Layout = "~/Views/Shared/_PanelLayout.cshtml";

    var distinctDeviceNames = Model
        .Where(m => !string.IsNullOrWhiteSpace(m.DeviceName))
        .Select(m => m.DeviceName)
        .Distinct()
        .ToList();
}

<style>
    .table-orders {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }

    .bg-yes {
        background-color: #c6f6c6;
        color: #000;
        font-weight: bold;
        text-align: center;
    }

    .bg-no {
        background-color: #f9c6c6;
        color: #000;
        font-weight: bold;
        text-align: center;
    }

    .Vert-table {
        margin-top: 20px;
        overflow-x: auto;
    }

    .sort-container {
        margin-bottom: 10px;
    }

        .sort-container select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #aaa;
        }

    .Button-ClearAll {
        margin-bottom: 10px;
        background-color: #ff6666;
        border: none;
        color: #fff;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
    }

        .Button-ClearAll:hover {
            background-color: #ff4c4c;
        }

    th {
        background-color: #444444;
        border: 1px solid #dee2e6;
        padding: 8px;
        text-align: center;
        vertical-align: middle;
        color: white; /* Dodane dla czytelności na ciemnym tle */
    }

    td {
        border: 1px solid #dee2e6;
        padding: 6px;
    }
</style>

<div class="Page-Box">
    <div class="Page-Box-Container">
        <div class="Page-Box-Category">
            <div class="Category-Box-Title">
                Statusy Maszyn
            </div>
            <partial name="_ManageNavCol" />
        </div>

        <div class="sort-container">
            <label for="deviceNameFilter">Maszyny</label>
            <select id="deviceNameFilter">
                <option value="">Wszystkie</option>
                @foreach (var name in distinctDeviceNames)
                {
                    <option value="@name">@name</option>
                }
            </select>
        </div>

        <div class="Vert-table">
            <form asp-action="ClearAll" method="post"
                  onsubmit="return confirm('Czy na pewno chcesz usunąć wszystkie wpisy?');">
                <button type="submit" class="Button-ClearAll">Usuń wszystkie wpisy</button>
            </form>

            <table class="table-orders" id="deviceTable">
                <thead>
                    <tr>
                        <th rowspan="2">Nazwa urządzenia</th>
                        <th rowspan="2">Ostatni meldunek</th>
                        <th rowspan="2">Online</th>
                        <th colspan="5" style="background-color: royalblue;">Sklepy</th>
                        <th colspan="4" style="background-color: orange;">Allegro</th>
                        <th colspan="3" style="background-color: darkgreen;">Dodatkowe Usługi</th>
                        <th colspan="2" style="background-color: blueviolet;">Automatyzacja</th>
                    </tr>
                    <tr>
                        <th title="URL Scalanie">URL</th>
                        <th title="Ceneo Crawler">Ceneo</th>
                        <th title="Google Crawler">Google</th>
                        <th title="API Bot Sklepu (Ceny)">API Bot</th>
                        <th title="Scalanie Bazy">Scalanie</th>

                        <th title="Allegro URL Scalanie">Ale URL</th>
                        <th title="Allegro Crawler">Ale Craw</th>
                        <th title="Allegro API Bot">Ale API</th>
                        <th title="Allegro Scalanie">Ale Scal</th>

                        <th>Faktury</th>
                        <th>Płatności</th>
                        <th>Maile</th>

                        <th title="Automatyzacja Marketplace (Allegro)">Auto Market</th>
                        <th title="Automatyzacja Porównywarek (Ceneo/Google)">Auto Comp</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="td-deviceName">@item.DeviceName</td>
                            <td style="text-align:center;">@item.LastCheck.ToString("dd.MM HH:mm")</td>
                            <td class="@(item.IsOnline ? "bg-yes" : "bg-no")">
                                @(item.IsOnline ? "tak" : "nie")
                            </td>

                            <td class="@(item.UrlScalEnabled ? "bg-yes" : "bg-no")">
                                @(item.UrlScalEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.CenCrawEnabled ? "bg-yes" : "bg-no")">
                                @(item.CenCrawEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.GooCrawEnabled ? "bg-yes" : "bg-no")">
                                @(item.GooCrawEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.ApiBotEnabled ? "bg-yes" : "bg-no")">
                                @(item.ApiBotEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.BaseScalEnabled ? "bg-yes" : "bg-no")">
                                @(item.BaseScalEnabled ? "tak" : "nie")
                            </td>

                            <td class="@(item.UrlScalAleEnabled ? "bg-yes" : "bg-no")">
                                @(item.UrlScalAleEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.AleCrawEnabled ? "bg-yes" : "bg-no")">
                                @(item.AleCrawEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.AleApiBotEnabled ? "bg-yes" : "bg-no")">
                                @(item.AleApiBotEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.AleBaseScalEnabled ? "bg-yes" : "bg-no")">
                                @(item.AleBaseScalEnabled ? "tak" : "nie")
                            </td>

                            <td class="@(item.InvoiceGeneratorEnabled ? "bg-yes" : "bg-no")">
                                @(item.InvoiceGeneratorEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.PaymentProcessorEnabled ? "bg-yes" : "bg-no")">
                                @(item.PaymentProcessorEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.EmailSenderEnabled ? "bg-yes" : "bg-no")">
                                @(item.EmailSenderEnabled ? "tak" : "nie")
                            </td>

                            <td class="@(item.MarketPlaceAutomationEnabled ? "bg-yes" : "bg-no")">
                                @(item.MarketPlaceAutomationEnabled ? "tak" : "nie")
                            </td>
                            <td class="@(item.PriceComparisonAutomationEnabled ? "bg-yes" : "bg-no")">
                                @(item.PriceComparisonAutomationEnabled ? "tak" : "nie")
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const dropdown = document.getElementById('deviceNameFilter');
        const table = document.getElementById('deviceTable');
        const rows = Array.from(table.querySelectorAll('tbody tr'));

        dropdown.addEventListener('change', function () {
            const selectedName = dropdown.value.trim().toLowerCase();

            rows.forEach(row => {
                const deviceNameCell = row.querySelector('.td-deviceName');
                if (!deviceNameCell) return;

                const rowDeviceName = deviceNameCell.textContent.trim().toLowerCase();

                if (selectedName === "" || rowDeviceName === selectedName) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        });
    </script>
}