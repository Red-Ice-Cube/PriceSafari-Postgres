@model PriceSafari.Models.StoreClass

@{
    ViewData["Title"] = "Edycja Sklepu";
    Layout = "~/Views/Shared/_PanelLayout.cshtml";
}

<style>

    .form-actions-sticky {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #dee2e6;
        z-index: 1020;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-left: -24px;
        margin-right: -24px;
        margin-bottom: 24px;
    }

    .card + .card {
        margin-top: 24px;
    }
</style>

<form asp-action="EditStore" method="post">
    <input type="hidden" asp-for="StoreId" />

    <div class="form-actions-sticky">
        <h2 class="h4 mb-0">Edytujesz: @Model.StoreName</h2>
        <div>
            <a asp-action="Index" class="btn btn-secondary">Anuluj</a>
            <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h4>Dane Podstawowe</h4>
        </div>
        <div class="card-body">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label asp-for="StoreName">Nazwa sklepu</label>
                    <input asp-for="StoreName" class="form-control" placeholder="Np. Akson" />
                    <span asp-validation-for="StoreName" class="text-danger"></span>
                </div>
                <div class="form-group col-md-6">
                    <label asp-for="StoreProfile">Profil sklepu Ceneo</label>
                    <input asp-for="StoreProfile" class="form-control" placeholder="Np. Sklep z elektroniką" />
                    <span asp-validation-for="StoreProfile" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group">
                <label asp-for="StoreLogoUrl">URL logo sklepu</label>
                <input asp-for="StoreLogoUrl" class="form-control" placeholder="https://.../logo.png" />
                <span asp-validation-for="StoreLogoUrl" class="text-danger"></span>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h4>Konfiguracja API i Plików XML</h4>
        </div>
        <div class="card-body">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label asp-for="StoreApiUrl">URL API</label>
                    <input asp-for="StoreApiUrl" class="form-control" placeholder="Adres bazowy API sklepu" />
                    <span asp-validation-for="StoreApiUrl" class="text-danger"></span>
                </div>
                <div class="form-group col-md-6">
                    <label asp-for="StoreApiKey">Klucz API</label>
                    <input asp-for="StoreApiKey" class="form-control" />
                    <span asp-validation-for="StoreApiKey" class="text-danger"></span>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label asp-for="ProductMapXmlUrl">URL pliku XML (Ceneo)</label>
                    <input asp-for="ProductMapXmlUrl" class="form-control" placeholder="Adres do pliku XML z produktami" />
                    <span asp-validation-for="ProductMapXmlUrl" class="text-danger"></span>
                </div>
                <div class="form-group col-md-6">
                    <label asp-for="ProductMapXmlUrlGoogle">URL pliku XML (Google)</label>
                    <input asp-for="ProductMapXmlUrlGoogle" class="form-control" placeholder="Adres do pliku XML dla Google" />
                    <span asp-validation-for="ProductMapXmlUrlGoogle" class="text-danger"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h4>Integracje (Google, Ceneo, Allegro)</h4>
        </div>
        <div class="card-body">
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label asp-for="StoreNameCeneo">Nazwa sklepu w Ceneo</label>
                    <input asp-for="StoreNameCeneo" class="form-control" />
                    <span asp-validation-for="StoreNameCeneo" class="text-danger"></span>
                </div>
                <div class="form-group col-md-4">
                    <label asp-for="StoreNameGoogle">Nazwa sklepu w Google</label>
                    <input asp-for="StoreNameGoogle" class="form-control" />
                    <span asp-validation-for="StoreNameGoogle" class="text-danger"></span>
                </div>
                <div class="form-group col-md-4">
                    <label asp-for="StoreNameAllegro">Nazwa sklepu w Allegro</label>
                    <input asp-for="StoreNameAllegro" class="form-control" />
                    <span asp-validation-for="StoreNameAllegro" class="text-danger"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h4>Plan i Pozostałe Ustawienia</h4>
        </div>
        <div class="card-body">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label asp-for="PlanId">Przypisany Plan</label>
                    <select asp-for="PlanId" class="form-control" asp-items="ViewBag.Plans">
                        <option value="">-- Wybierz Plan --</option>
                    </select>
                    <span asp-validation-for="PlanId" class="text-danger"></span>
                </div>
                <div class="form-group col-md-6">
                    <label asp-for="DiscountPercentage">Procent rabatu (%)</label>
                    <input asp-for="DiscountPercentage" class="form-control" type="number" step="0.01" />
                    <span asp-validation-for="DiscountPercentage" class="text-danger"></span>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label asp-for="ProductsToScrap">Limit produktów (Porównywarki)</label>
                    <input asp-for="ProductsToScrap" class="form-control" type="number" />
                    <span asp-validation-for="ProductsToScrap" class="text-danger"></span>
                </div>
                <div class="form-group col-md-4">
                    <label asp-for="ProductsToScrapAllegro">Limit produktów (Allegro)</label>
                    <input asp-for="ProductsToScrapAllegro" class="form-control" type="number" />
                    <span asp-validation-for="ProductsToScrapAllegro" class="text-danger"></span>
                </div>
                <div class="form-group col-md-4">
                    <label asp-for="RemainingDays">Pozostało zeskrobań</label>
                    <input asp-for="RemainingDays" class="form-control" type="number" />
                    <span asp-validation-for="RemainingDays" class="text-danger"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h4>Aktywacja Modułów</h4>
        </div>
        <div class="card-body">
            <p class="text-muted">Zaznacz, które moduły i źródła danych mają być aktywne dla tego sklepu.</p>
            <div class="form-group">
                <div class="form-check">
                    <input asp-for="OnCeneo" class="form-check-input" type="checkbox" />
                    <label asp-for="OnCeneo" class="form-check-label">Ceneo aktywne</label>
                </div>
                <div class="form-check">
                    <input asp-for="OnGoogle" class="form-check-input" type="checkbox" />
                    <label asp-for="OnGoogle" class="form-check-label">Google aktywne</label>
                </div>
                <div class="form-check">
                    <input asp-for="OnAllegro" class="form-check-input" type="checkbox" />
                    <label asp-for="OnAllegro" class="form-check-label">Allegro aktywne</label>
                </div>
                <hr />
                <div class="form-check">
                    <input asp-for="UseGoogleXMLFeedPrice" class="form-check-input" type="checkbox" />
                    <label asp-for="UseGoogleXMLFeedPrice" class="form-check-label font-weight-bold">Importuj ceny z pliku Google XML (ostrzykiwanie)</label>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header">
            <h4>Zaawansowana Integracja Allegro</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5>Ustawienia Funkcjonalne</h5>
                    <hr />
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input asp-for="IsAllegroPriceBridgeActive" type="checkbox" class="custom-control-input" id="allegroBridgeSwitch">
                            <label class="custom-control-label font-weight-bold" for="allegroBridgeSwitch">
                                Aktywny Allegro Price Bridge (Most Cenowy)
                            </label>
                            <small class="form-text text-muted">
                                Włącza możliwość automatycznej zmiany cen ofert poprzez API Allegro.
                            </small>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input asp-for="FetchExtendedAllegroData" type="checkbox" class="custom-control-input" id="allegroDataSwitch">
                            <label class="custom-control-label" for="allegroDataSwitch">
                                @Html.DisplayNameFor(m => m.FetchExtendedAllegroData)
                            </label>
                            <small class="form-text text-muted">
                                Pobieraj dodatkowe dane o ofertach bezpośrednio z API Allegro.
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h5>
                        Token API
                        @if (Model.IsAllegroTokenActive)
                        {
                            <span class="badge badge-success ml-2">AKTYWNY</span>
                        }
                        else
                        {
                            <span class="badge badge-danger ml-2">NIEAKTYWNY</span>
                        }
                    </h5>
                    <hr />
                    <div class="form-group">
                        <label asp-for="AllegroApiToken">Obecny Token</label>
                        <div class="input-group">
                            <input asp-for="AllegroApiToken" value="@Model.AllegroApiToken" class="form-control" id="allegroTokenInput" type="password" autocomplete="off" placeholder="Brak tokenu" />
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="toggleTokenVisibility" title="Pokaż/Ukryj">
                                    👁️
                                </button>
                                <button class="btn btn-outline-danger" type="button" id="clearTokenBtn" title="Wyczyść token">
                                    🗑️ Usuń
                                </button>
                            </div>
                        </div>
                        <span asp-validation-for="AllegroApiToken" class="text-danger"></span>
                        <small class="form-text text-muted">
                            Aby usunąć token, kliknij przycisk kosza i zapisz zmiany.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="form-group mt-4">
        <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
        <a asp-action="Index" class="btn btn-secondary">Anuluj</a>
    </div>

</form>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        $(document).ready(function () {

            $('#clearTokenBtn').on('click', function () {
                if (confirm('Czy na pewno chcesz wyczyścić pole tokenu? Musisz zapisać zmiany, aby zatwierdzić usunięcie.')) {
                    $('#allegroTokenInput').val('').trigger('change');
                }
            });

            $('#toggleTokenVisibility').on('click', function () {
                var input = $('#allegroTokenInput');
                if (input.attr('type') === 'password') {
                    input.attr('type', 'text');
                } else {
                    input.attr('type', 'password');
                }
            });
        });
    </script>
}