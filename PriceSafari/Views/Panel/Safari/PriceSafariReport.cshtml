@model List<PriceSafari.Models.PriceSafariReport>

@{
    ViewData["Title"] = "Raporty Safari";
    Layout = "~/Views/Shared/_PanelLayout.cshtml";
    var storeId = ViewBag.StoreId;
    var reportCountries = ViewBag.ReportCountries as Dictionary<int, List<string>>;
}

<div class="Vert">
    <div class="Vert-full">
        <div class="price-box-space">
            <div class="Order-Container-Title">
                Raporty Safari dla sklepu @ViewBag.StoreName
            </div>
            <a href="@Url.Action("Index", "Safari", new { storeId = ViewBag.StoreId })" class="Button-Action-Small">Dodaj raport</a>
        </div>

        @if (Model.Any())
        {
            <div class="Vert-table">
                <table class="table-orders">
                    <thead>
                        <tr>
                            <th>Raport</th>
                            <th>Zlecono</th>
                            <th>Przygotowano</th>
                            <th>Status</th>
                            <th>Produkty</th>
                            <th>Kraje</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var report in Model)
                        {
                            <tr data-url="@Url.Action("SafariReportAnalysis", "Safari", new { reportId = report.ReportId })" style="cursor:pointer;">
                                <td style="font-size:19px; font-weight:300;">@report.ReportName</td>
                                <td>@report.CreatedDate.ToString("yyyy-MM-dd HH:mm")</td>
                                <td>@(report.ReadyDate?.ToString("yyyy-MM-dd HH:mm") ?? "W przygotowaniu")</td>
                                <td>
                                    @if (report.Prepared == true)
                                    {
                                        <span style="color: green;">Gotowy</span>
                                    }
                                    else
                                    {
                                        <span style="color: red;">Nieprzygotowany</span>
                                    }
                                </td>
                                <td>@(report.ProductIds?.Count() ?? 0)</td>
                                <td id="flags-@report.ReportId"></td> <!-- Miejsce, gdzie wstawimy flagi -->
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        
    </div>
</div>

<!-- Dodanie skryptu JavaScript do klikalnych wierszy -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
      
        var rows = document.querySelectorAll("tr[data-url]");
        rows.forEach(function (row) {
            row.addEventListener("click", function () {
                var url = row.getAttribute("data-url");
                if (url) {
                    window.location.href = url;  
                }
            });
        });

  
        var reportCountries = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(reportCountries));
        Object.keys(reportCountries).forEach(function (reportId) {
            var flagsContainer = document.getElementById('flags-' + reportId);
            if (flagsContainer) {
                reportCountries[reportId].forEach(function (flag) {
                    var img = document.createElement('img');
                    img.src = '/images/' + flag + '.png';  
                    img.alt = flag;
                    img.style.height = '22px';
                    img.style.width = '32px';
                    img.style.marginRight = '5px';
                    flagsContainer.appendChild(img);
                });
            }
        });
    });
</script>
