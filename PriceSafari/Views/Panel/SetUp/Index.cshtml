@model PriceSafari.Models.ViewModels.SetUpViewModel
@{
    ViewData["Title"] = "Konfiguracja Konta";
    Layout = "~/Views/Shared/_PanelLayout.cshtml";
}

<style>
    /* Style dla strony konfiguracji (Setup) */
    .setup-options-container {
        display: flex;
        flex-direction: column;
        gap: 20px; /* Odstęp między opcjami */
    }

    .setup-option {
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        overflow: hidden; /* Ważne dla animacji i zaokrąglonych rogów */
    }

    .setup-option-header {
        display: flex;
        align-items: center;
        padding: 1.5rem;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
    }

        .setup-option-header:hover {
            background-color: #f8f9fa;
        }

    .source-logo {
        width: 48px;
        height: 48px;
        margin-right: 1.5rem;
    }

    .header-text h4 {
        margin: 0;
        font-weight: 600;
    }

    .header-text p {
        margin: 0;
        color: #6c757d;
    }

    .arrow-icon {
        margin-left: auto;
        font-size: 1.2rem;
        transition: transform 0.3s ease-in-out;
    }

        .arrow-icon.rotated {
            transform: rotate(180deg);
        }

    .setup-option-content {
        max-height: 0; /* Domyślnie schowany */
        overflow: hidden;
        transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out;
        padding: 0 1.5rem; /* Ukryty padding */
    }

        .setup-option-content.open {
            max-height: 500px; /* Wystarczająco duża wartość, aby pomieścić formularz */
            padding: 1.5rem;
            padding-top: 0;
            border-top: 1px solid #dee2e6;
        }

    .form-message {
        margin-bottom: 1rem;
        font-weight: 500;
    }

        .form-message.success {
            color: #198754; /* Zielony */
        }

        .form-message.error {
            color: #dc3545; /* Czerwony */
        }
</style>


<div class="container-fluid pt-4 px-4">
    <div class="row g-4">
        <div class="col-12">
            <div class="bg-light rounded h-100 p-4">
                <h2 class="mb-2">Witaj w konfiguratorze konta, @Model.UserName!</h2>
                <p class="lead mb-4">
                    Wybierz i skonfiguruj źródła danych, które chcesz monitorować.
                </p>

                <div class="setup-options-container">

                    <div class="setup-option">
                        <div class="setup-option-header" data-target="#ceneo-content">
                            <img src="~/images/Ceneo.png" alt="Ceneo" class="source-logo" />
                            <div class="header-text">
                                <h4>Sklep w Ceneo</h4>
                                <p>Podaj nazwę sklepu i link do feedu produktowego.</p>
                            </div>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="setup-option-content" id="ceneo-content">
                            <form id="ceneo-form">
                                <div class="mb-3">
                                    <label for="ceneoStoreName" class="form-label">Nazwa Twojego sklepu w Ceneo</label>
                                    <input type="text" class="form-control" id="ceneoStoreName" name="StoreName" placeholder="np. super-sklep" value="@Model.PendingStoreNameCeneo" required>
                                    <div class="form-text">To nazwa, która pojawia się w adresie URL Twojego sklepu na Ceneo.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="ceneoFeedUrl" class="form-label">Adres URL feedu produktowego dla Ceneo</label>
                                    <input type="url" class="form-control" id="ceneoFeedUrl" name="FeedUrl" placeholder="https://..." value="@Model.PendingCeneoFeedUrl" required>
                                    <div class="form-text">Link do pliku XML z Twoimi produktami.</div>
                                </div>
                                <div id="ceneo-message" class="form-message"></div>
                                <button type="submit" class="btn btn-primary">Zapisz konfigurację Ceneo</button>
                            </form>
                        </div>
                    </div>

                    <div class="setup-option">
                        <div class="setup-option-header" data-target="#google-content">
                            <img src="~/images/GoogleShopping.png" alt="Google Shopping" class="source-logo" />
                            <div class="header-text">
                                <h4>Google Shopping</h4>
                                <p>Podaj nazwę sklepu i link do feedu produktowego.</p>
                            </div>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="setup-option-content" id="google-content">
                            <form id="google-form">
                                <div class="mb-3">
                                    <label for="googleStoreName" class="form-label">Nazwa Twojego sklepu</label>
                                    <input type="text" class="form-control" id="googleStoreName" name="StoreName" placeholder="np. Mój Sklep" value="@Model.PendingStoreNameGoogle" required>
                                    <div class="form-text">Twoja nazwa handlowa.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="googleFeedUrl" class="form-label">Adres URL feedu produktowego dla Google</label>
                                    <input type="url" class="form-control" id="googleFeedUrl" name="FeedUrl" placeholder="https://..." value="@Model.PendingGoogleFeedUrl" required>
                                    <div class="form-text">Link do pliku XML z Twoimi produktami dla Google Merchant Center.</div>
                                </div>
                                <div id="google-message" class="form-message"></div>
                                <button type="submit" class="btn btn-primary">Zapisz konfigurację Google</button>
                            </form>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Logika dla rozwijanych paneli (akordeon)
            const headers = document.querySelectorAll('.setup-option-header');
            headers.forEach(header => {
                header.addEventListener('click', () => {
                    const content = document.querySelector(header.dataset.target);
                    const arrow = header.querySelector('.arrow-icon');

                    content.classList.toggle('open');
                    arrow.classList.toggle('rotated');
                });
            });

            // Logika dla formularza Ceneo
            const ceneoForm = document.getElementById('ceneo-form');
            ceneoForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(ceneoForm);
                const messageDiv = document.getElementById('ceneo-message');

                fetch('@Url.Action("SaveCeneo", "SetUp")', {
                    method: 'POST',
                    headers: {
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: new URLSearchParams(formData)
                })
                .then(res => res.json())
                .then(data => {
                    messageDiv.textContent = data.message;
                    messageDiv.className = data.success ? 'form-message success' : 'form-message error';
                });
            });

            // Logika dla formularza Google
            const googleForm = document.getElementById('google-form');
            googleForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(googleForm);
                const messageDiv = document.getElementById('google-message');

                fetch('@Url.Action("SaveGoogleShopping", "SetUp")', {
                    method: 'POST',
                     headers: {
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: new URLSearchParams(formData)
                })
                .then(res => res.json())
                .then(data => {
                    messageDiv.textContent = data.message;
                    messageDiv.className = data.success ? 'form-message success' : 'form-message error';
                });
            });
        });
    </script>
}